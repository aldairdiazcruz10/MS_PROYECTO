<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Docentes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/docentes.css">
</head>
<body>
    <div class="main-container fade-in">
        <!-- Header -->
        

        <div class="header-section">
            <h1 class="header-title">
                <i class="fas fa-chalkboard-teacher"></i>
                Listado de Docentes
            </h1>
            <p class="mb-0 opacity-75">Gestión del personal docente de la institución</p>
            <a href="{{ url_for('inicio.index') }}" class="menu-item text-white text-decoration-none" alt="Logo" width="25" class="me-2">
                <i class="fas fa-home"></i> REGRESAR A INICIO
            </a>

        </div>
        <!-- Estadísticas -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-number" id="totalDocentes">{{ docentes|length }}</div>
                <div>Total Docentes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="resultadosBusqueda">{{ docentes|length }}</div>
                <div>Resultados Mostrados</div>
            </div>
        </div>

        <!-- Sección de búsqueda y acciones -->
        <div class="search-section">
            <div class="row align-items-center">
                <div class="col-md-6 mb-3 mb-md-0">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0" style="border-radius: 50px 0 0 50px;">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" class="form-control search-input border-start-0" 
                               id="searchInput" placeholder="Buscar por nombre, apellido o DNI..." 
                               style="border-radius: 0 50px 50px 0;">
                    </div>
                </div>
                <div class="col-md-6 text-md-end">
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addDocenteModal">
                        <i class="fas fa-plus me-2"></i>Agregar Docente
                    </button>
                    <a href="{{ url_for('docente.exportar_docentes') }}" class="btn btn-success">
        <i class="fas fa-file-excel me-2"></i> Exportar a Excel
    </a>
                    
                </div>
            </div>
        </div>

        <!-- Tabla de docentes -->
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>DNI</th>
                            <th>Primer Apellido</th>
                            <th>Segundo Apellido</th>
                            <th>Primer Nombre</th>
                            <th>Segundo Nombre</th>
                            <th>Correo Institucional</th>
                            <th>Número</th>
                            <th class="text-center">Acciones</th>
                            <th class="text-center">Mensajes</th>
                        </tr>
                    </thead>
                    <tbody id="docentesTableBody">
                        {% for docente in docentes %}
                        <tr>
                            <td>{{ docente.id }}</td>
                            <td>{{ docente.dni }}</td>
                            <td>{{ docente.primer_apellido }}</td>
                            <td>{{ docente.segundo_apellido }}</td>
                            <td>{{ docente.primer_nombre }}</td>
                            <td>{{ docente.segundo_nombre }}</td>
                            <td>{{ docente.correo_institucional }}</td>
                            <td>{{ docente.celular }}</td>
                            <td class="text-center">
                                 <!-- Botón Editar -->
            <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editDocenteModal" onclick="loadEditData('{{ docente.id }}',
                                   '{{ docente.primer_nombre }}',
                                   '{{ docente.segundo_nombre }}',
                                   '{{ docente.primer_apellido }}',
                                   '{{ docente.segundo_apellido}}',
                                   '{{ docente.correo_institucional }}',
                                   '{{ docente.celular }}')">
                <i class="fas fa-edit"></i>
            </button>
            
            <!-- Botón Eliminar -->
            <form method="POST" action="/docentes/eliminar/{{ docente.id }}" class="d-inline">
                <button type="submit" class="btn btn-danger btn-sm"
                    onclick="return confirm('¿Seguro que deseas eliminar este docente?')">
                    <i class="fas fa-trash"></i>
                </button>
            </form>


            <td>
                <button type="submit" class="btn btn-primary btn-sm"
                        onclick="abrirModalCorreo('{{ docente.id }}', '{{ docente.primer_nombre }} {{ docente.primer_apellido }}')">
                    corre📧
                </button>
               
            </td>



                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Mensaje sin resultados -->
            <div id="noResults" class="no-results d-none">
                <i class="fas fa-search fa-3x mb-3 text-muted"></i>
                <h4>No se encontraron resultados</h4>
                <p>Intenta con otros términos de búsqueda</p>
            </div>
        </div>
    </div>

    <!-- Modal para agregar docente -->
    <div class="modal fade" id="addDocenteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-plus me-2"></i>Agregar Nuevo Docente
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addDocenteForm" method="POST" action="{{ url_for('docente.agregar_docente') }}">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">DNI *</label>
                                <input type="text" class="form-control" name="dni" required maxlength="8" pattern="[0-9]{8}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Número</label>
                                <input type="text" class="form-control" name="celular" placeholder="+51 999 123 456">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Primer Apellido *</label>
                                <input type="text" class="form-control" name="primer_apellido" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Segundo Apellido</label>
                                <input type="text" class="form-control" name="segundo_apellido">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Primer Nombre *</label>
                                <input type="text" class="form-control" name="primer_nombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Segundo Nombre</label>
                                <input type="text" class="form-control" name="segundo_nombre">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Correo Institucional *</label>
                            <input type="email" class="form-control" name="correo_institucional" required 
                                   placeholder="nombre@institucion.edu">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="saveDocente()">
                        <i class="fas fa-save me-2"></i>Guardar Docente
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Editar Docente -->
    <div class="modal fade" id="editDocenteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="editDocenteForm" method="POST">
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Editar Docente</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="id" id="editId">
    
                        <div class="mb-3">
                            <label class="form-label">Primer Nombre</label>
                            <input type="text" class="form-control" name="primer_nombre" id="editNombre" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Segundo  Nombre</label>
                            <input type="text" class="form-control" name="segundo_nombre" id="editNombre2" required>
                        </div>
    
                        <div class="mb-3">
                            <label class="form-label">Primer Apellido</label>
                            <input type="text" class="form-control" name="primer_apellido" id="editApellido" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Segundo Apellido </label>
                            <input type="text" class="form-control" name="segundo_apellido" id="editApellido2" required>
                        </div>
    
                        <div class="mb-3">
                            <label class="form-label">Correo Institucional</label>
                            <input type="email" class="form-control" name="correo_institucional" id="editCorreo" required>
                        </div>
    
                        <div class="mb-3">
                            <label class="form-label">Celular</label>
                            <input type="text" class="form-control" name="celular" id="editCelular">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-warning">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Modal de confirmación para eliminar -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminación
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro de que deseas eliminar al docente:</p>
                    <h6 id="docenteToDelete" class="text-primary"></h6>
                    <p class="text-muted">Esta acción no se puede deshacer.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="fas fa-trash me-2"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>
<!-- Modal -->
    <div class="modal fade" id="modalCorreo" tabindex="-1" aria-labelledby="modalCorreoLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="formCorreo" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCorreoLabel">
            Enviar correo a <span id="nombreDocente"></span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input type="hidden" name="docente_id" id="docente_id">

          <div class="mb-3">
            <label for="asunto" class="form-label">Asunto:</label>
            <input type="text" class="form-control" name="asunto" id="asunto" required>
          </div>

          <div class="mb-3">
            <label for="mensaje" class="form-label">Mensaje:</label>
            <textarea class="form-control" name="mensaje" id="mensaje" rows="3" required></textarea>
          </div>

          <!-- Campo para subir o pegar múltiples imágenes -->
          <div class="mb-3">
            <label class="form-label">Imágenes adjuntas:</label>
            <input type="file" class="form-control" name="imagenes[]" id="imagenes" accept="image/*" multiple>

            <div id="previewContainer" class="mt-3 d-flex flex-wrap gap-2 d-none">
              <!-- Aquí se mostrarán las vistas previas -->
            </div>

            <small class="text-muted d-block mt-2">
              También puedes pegar imágenes con Ctrl + V 📋
            </small>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Enviar correo</button>
        </div>
      </form>
    </div>
  </div>
</div>

    
    <script src="{{ url_for('static', filename='js/correo.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/docentes.js') }}"></script>
</body>
</html>